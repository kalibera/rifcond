
R Under development (unstable) (2018-01-22 r74151) -- "Unsuffered Consequences"
Copyright (C) 2018 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #
> # testing invariance 
> #
> 
> # simulation:
> # factor structure holds over SES but not over age
> # both SES and age predict a mean difference in cognitive outcome
> 
> set.seed(123)
> 
> require("semtree")
Loading required package: semtree
Loading required package: OpenMx
To take full advantage of multiple cores, use:
  mxOption(NULL, 'Number of Threads', parallel::detectCores()) #now
  Sys.setenv(OMP_NUM_THREADS=parallel::detectCores()) #before library(OpenMx)
> require("lavaan")
Loading required package: lavaan
This is lavaan 0.5-23.1097
lavaan is BETA software! Please report any bugs.

Attaching package: 'lavaan'

The following object is masked from 'package:OpenMx':

    vech

> #
> lambda <- list()
> age <- c(0,0,1,1) # 0=young, 1 =old
> ses <- c(0,1,0,1) # 0=low, 1=high
> lambda[[1]] <- c(1,0.9,0.8,0.8)
> lambda[[2]] <- c(1,0.9,0.8,0.8)
> lambda[[3]] <- c(1,0.4,0.2,0.9)
> lambda[[4]] <- c(1,0.4,0.2,0.9)
> cogmean <- 80-age*30 + ses*20
> cogsd <- 1
> errsd <- 1
> 
> Nsub <- 200 # persons per agexSES group
> 
> cbind(age,ses,cogmean)
     age ses cogmean
[1,]   0   0      80
[2,]   0   1     100
[3,]   1   0      50
[4,]   1   1      70
> 
> # simulate data from 4 groups
> data <- c()
> for (i in 1:4) {
+   cogsim <- rnorm(n = Nsub,mean = cogmean[i],cogsd)
+   scores <- as.matrix(t(outer(lambda[[i]],cogsim))) + rnorm(Nsub*4,0,errsd)
+   data <- rbind(data,scores)
+ }
> data <- data.frame(data)
> names(data) <- paste0("x",1:4)
> 
> fulldata <- cbind(data, age=rep(age,each=Nsub),ses=rep(ses,each=Nsub))
> #
> model<-"
+ ! regressions 
+ F=~1.0*x1
+ F=~l2*x2
+ F=~l3*x3
+ F=~l4*x4
+ ! residuals, variances and covariances
+ x1 ~~ VAR_x1*x1
+ x2 ~~ VAR_x2*x2
+ x3 ~~ VAR_x3*x3
+ x4 ~~ VAR_x4*x4
+ F ~~ 1.0*F
+ ! means
+ F~1
+ x1~0*1;
+ x2~0*1;
+ x3~0*1;
+ x4~0*1;
+ ";
> result<-lavaan(model, data=data, fixed.x=FALSE, missing="FIML");
> 
> manifests<-c("x1","x2","x3","x4")
> latents<-c("F")
> model <- mxModel("Unnamed_Model", 
+                  type="RAM",
+                  manifestVars = manifests,
+                  latentVars = latents,
+                  mxPath(from="F",to=c("x1","x2","x3","x4"), free=c(FALSE,TRUE,TRUE,TRUE),
+                         value=c(1.0,1.0,1.0,1.0) , arrows=1, label=c("F__x1","l2","l3","l4") ),
+                  mxPath(from="one",to=c("F"), free=c(TRUE), value=c(1.0) , arrows=1, label=c("const__F") ),
+                  mxPath(from="one",to=c("x2","x3","x4"), free=c(TRUE,TRUE,TRUE), value=c(1.0,1.0,1.0) , arrows=1, label=c("const__x2","const__x3","const__x4") ),
+                  mxPath(from="x1",to=c("x1"), free=c(TRUE), value=c(1.0) , arrows=2, label=c("VAR_x1") ),
+                  mxPath(from="x2",to=c("x2"), free=c(TRUE), value=c(1.0) , arrows=2, label=c("VAR_x2") ),
+                  mxPath(from="x3",to=c("x3"), free=c(TRUE), value=c(1.0) , arrows=2, label=c("VAR_x3") ),
+                  mxPath(from="x4",to=c("x4"), free=c(TRUE), value=c(1.0) , arrows=2, label=c("VAR_x4") ),
+                  mxPath(from="F",to=c("F"), free=c(FALSE), value=c(1.0) , arrows=2, label=c("VAR_F") ),
+                  mxPath(from="one",to=c("x1"), free=F, value=0, arrows=1),
+                  mxData(data[1:50,], type = "raw")
+ );
> 
> result <- mxTryHard(model)

Begin fit attempt 1 of at maximum 11 tries

 Lowest minimum so far:  611.424058217578

 OpenMx status code 6 not in list of acceptable status codes, 0
 OpenMx status code 6 not in list of acceptable status codes, 0

Begin fit attempt 2 of at maximum 11 tries

 Lowest minimum so far:  611.424057895294

Solution found


Start values from best fit:
0.293667496267348,0.691837272676587,0.643068495701107,0.516613765196442,1.06105504468049,1.0759914953725,1.1570794886512,48.464360910926,8.49983868355222,12.5591315626013,80.0258856633211
> summary(result)
Summary of Unnamed_Model 
 
free parameters:
        name matrix row col   Estimate  Std.Error A
1         l2      A  x2   F  0.2936675  0.1879669  
2         l3      A  x3   F  0.6918373  0.2318763  
3         l4      A  x4   F  0.6430685  0.2271287  
4     VAR_x1      S  x1  x1  0.5166138  0.2724498  
5     VAR_x2      S  x2  x2  1.0610550  0.2192919  
6     VAR_x3      S  x3  x3  1.0759915  0.2783940  
7     VAR_x4      S  x4  x4  1.1570795  0.2790211  
8  const__x2      M   1  x2 48.4643609 15.0429527  
9  const__x3      M   1  x3  8.4998387 18.5568091  
10 const__x4      M   1  x4 12.5591316 18.1769213  
11  const__F      M   1   F 80.0258857  0.1741616  

Model Statistics: 
               |  Parameters  |  Degrees of Freedom  |  Fit (-2lnL units)
       Model:             11                    189              611.4241
   Saturated:             14                    186                    NA
Independence:              8                    192                    NA
Number of observations/statistics: 50/200

Information Criteria: 
      |  df Penalty  |  Parameters Penalty  |  Sample-Size Adjusted
AIC:       233.4241               633.4241                       NA
BIC:      -127.9483               654.4563                 619.9291
To get additional fit indices, see help(mxRefModels)
timestamp: 2018-01-24 21:49:39 
Wall clock time: 0.2523308 secs 
optimizer:  CSOLNP 
OpenMx version number: 2.8.3 
Need help?  See help(mxSummary) 

> 
> subset <- data[1:50, ]
> 
> 
> ctr <- semtree.control(verbose=TRUE)
> ctr$exclude.heywood <- FALSE
> # naive tree should find both effects, age & ses, with age having the stronger effect 
> tree <- semtree(model = result, data=fulldata, control=ctr )
Detected OpenMx model.
MODEL IDS 1234
COV IDS 56
OpenMx model estimation selected!
Growing level 0
Testing Covariate: 5/6 (age)
 ----------- FAILURE REPORT -------------- 
 --- srcref --- 
: 
 --- if/while statement is in package --- 
semtree
 --- call (currently evaluated) --- 
withCallingHandlers(expr, warning = function(w) invokeRestart("muffleWarning"))
 --- R stacktrace ---
where 1: withCallingHandlers(expr, warning = function(w) invokeRestart("muffleWarning"))
where 2 at /var/scratch2/tomas/tmp/RtmpPJ2l3Z/R.INSTALL2a2179a8693/semtree/R/fitSubmodels.R#40: suppressWarnings(if (is.na(run1)) return(NA))
where 3 at /var/scratch2/tomas/tmp/RtmpPJ2l3Z/R.INSTALL2a2179a8693/semtree/R/naiveSplit.R#174: fitSubmodels(model, subset1, subset2, control, invariance = NULL)
where 4: naiveSplit(model, mydata, control, invariance, meta, constraints = constraints, 
    ...)
where 5: doTryCatch(return(expr), name, parentenv, handler)
where 6: tryCatchOne(expr, names, parentenv, handlers[[1L]])
where 7: tryCatchList(expr, classes, parentenv, handlers)
where 8 at /var/scratch2/tomas/tmp/RtmpPJ2l3Z/R.INSTALL2a2179a8693/semtree/R/growTree.R#180: tryCatch(naiveSplit(model, mydata, control, invariance, meta, 
    constraints = constraints, ...), error = function(e) {
    cat(paste("Error occured!", e, sep = "\n"))
    return(NULL)
})
where 9 at /var/scratch2/tomas/tmp/RtmpPJ2l3Z/R.INSTALL2a2179a8693/semtree/R/semtree.R#271: growTree(model = model, mydata = dataset, control = control, 
    invariance = invariance, meta = meta, constraints = constraints, 
    ...)
where 10: semtree(model = result, data = fulldata, control = ctr)

 --- value of length: 2 type: logical ---
model    LL 
FALSE FALSE 
 --- function (currently evaluated)--- 
function (expr, ...) 
{
    handlers <- list(...)
    classes <- names(handlers)
    parentenv <- parent.frame()
    if (length(classes) != length(handlers)) 
        stop("bad handler specification")
    .Internal(.addCondHands(classes, handlers, parentenv, NULL, 
        TRUE))
    expr
}
<bytecode: 0x176a2d8>
<environment: namespace:base>
 --- function (body) search ---
Function withCallingHandlers in namespace base has this body.
 ----------- END FAILURE REPORT -------------- 
Fatal error: the condition has length > 1 and only the first element will be used XXXXXX
